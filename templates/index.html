<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <script>
      // Pass the notes from Python to JavaScript safely
    </script>
    <title>NoteHub!</title>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h1 style="text-align: center; margin-top: 10px; margin-bottom: 50px">
            Note Hub! Create Read Update Delete
          </h1>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <h2>Create Your Notes!</h2>
          <hr />
          <form method="post" action="">
            <div class="form-group">
              <label for="noteTitle">Note Title</label>
              <input
                type="text"
                class="form-control"
                id="noteTitle"
                placeholder="Enter Note Title"
              />
              <small id="" class="form-text text-muted">Keep Title Short</small>
            </div>
            <div class="form-group">
              <label for="noteDesc">Note Description</label>
              <textarea
                type="text"
                class="form-control"
                id="noteDesc"
                placeholder="Enter Description"
              ></textarea>
            </div>
            <div class="form-group">
              <label for="imp">Important ??</label>
              <select id="imp" class="form-control">
                <option selected>Choose...</option>
                <option value="Important">Important</option>
                <option value="Not Important">Not Important</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
        <div class="col-md-8">
          <div class="row">
            <div class="col-5">
              <h4>Titles</h4>
              <hr />
              <div class="list-group" id="list-tab" role="tablist">
                {% for note in noteColl %}
                <a
                  class="list-group-item list-group-item-action {% if loop.index==1 %}active {% endif %}"
                  data-note-id="{{ note.id }}"
                  data-toggle="list"
                  role="tab"
                  aria-controls="home"
                  onclick="readDesc(this)"
                  >{{note.title}}</a
                >
                <button
                  class="btn btn-danger btn-sm" style="width: 50%; float: right;" 
                  onclick="deleteNote('{{ note.id }}')"
                >
                  Delete
                </button>
                <hr />
                {% endfor %}
              </div>
            </div>
            <div class="col-7">
              <h4>Description</h4>
              <hr />
              <div class="tab-content" id="nav-tabContent">
                <p
                  id="isImp"
                  style="
                    background-color: yellow;
                    border-radius: 30px;
                    text-align: center;
                    width: 50%;
                  "
                >
                  {% if noteColl|length > 0 %} {{noteColl[0].isImp}} {% else %}
                  No description available. {% endif %}
                </p>
                <p id="desc_content" style="text-align: justify;">
                  {% if noteColl|length > 0 %} {{ noteColl[0].desc }}
                  <!-- Default to the first note's description -->
                  {% else %} No description available. {% endif %}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
    function readDesc(element) {
        const notes = {{ noteColl | tojson | safe }};
        const noteId = element.getAttribute('data-note-id');
    
        // Find the corresponding note object from the notes array
        const note = notes.find(n => n.id === noteId);
        if (note) {
            // Change the paragraph content to the description of the selected note
            const paragraph = document.getElementById('desc_content');
            paragraph.innerText = note.desc; // Set the paragraph text to the note's description
            const impStatus=document.getElementById('isImp');
            impStatus.innerText =note.isImp;
        }
    }
    
    function deleteNote(id) {
            // Make a DELETE request to the backend
            fetch(`/delete/${id}`, { method: "DELETE" })
    
                .then(response => {
                    if (response.ok) {
                        // // Optionally remove the note from the UI
                        // document.querySelector(`[data-note-id='${id}']`).remove();
                        // const noteContent = document.getElementById(id);
                        // if (noteContent) {
                        //     noteContent.remove();
                        // }
                        alert('Note deleted successfully.');
                    } else {
                        alert('Failed to delete note.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    
    </script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
